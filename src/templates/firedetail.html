{% extends 'base.html'%}

{% block content %}
<section class="projects-section bg-dark" id="projects">
    <div class="container">
        <!-- Featured Project Row-->
        <div class="row align-items-center no-gutters mb-4 mb-lg-5">
            <div class="col-xl-9 col-lg-7"><img class="img-fluid mb-3 mb-lg-0" src="{{fire.image.url}}" alt="" /></div>
            <div class="col-xl-3 col-lg-5">
                <div class="featured-text text-center text-lg-left">
                    <h4 class="text-white">{{fire.name}}</h4>
                    <p class="text-white-50 mb-0">Latitude: {{fire.latitude|floatformat:3}}</p>
                    <p class="text-white-50 mb-0">Longitude: {{fire.longitude|floatformat:3}}</p>
                    <p class="text-white-50 mb-0">Timestamp: {{fire.timestamp}}</p>
                    <p class="text-white-50 mb-0"> Description: {{fire.short_description}}</p>
                    <p class="text-white-50 mb-0">Cause: {{fire.cause}}</p>
                    <p class="text-white-50 mb-0">Probability: {{fire.probability}}</p>
                </div>
            </div>
        </div>
        <!-- semantic UI -->
        <link rel="stylesheet" type='text/css' href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.14/semantic.min.css">
        <!--Chart js-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" integrity="sha256-Uv9BNBucvCPipKQ2NS9wYpJmi8DTOEfTA/nH2aoJALw=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css" integrity="sha256-aa0xaJgmK/X74WM224KMQeNQC2xYKwlAt08oZqjeF0E=" crossorigin="anonymous" />
        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <canvas id="myChart" width="400" height="300"></canvas>
    </div>
</section>


<script>
var ctx = document.getElementById('myChart').getContext('2d');

const verticalLinePlugin = {
        getLinePosition: function (chart, pointIndex) {
            const meta = chart.getDatasetMeta(0); // first dataset is used to discover X coordinate of a point
            const data = meta.data;
            return data[pointIndex]._model.x;
        },
        renderVerticalLine: function (chartInstance, pointIndex) {
            const lineLeftOffset = this.getLinePosition(chartInstance, pointIndex);
            const scale = chartInstance.scales['y-axis-0'];
            const context = chartInstance.chart.ctx;

            // render vertical line
            context.beginPath();
            context.strokeStyle = '#ff0000';
            context.moveTo(lineLeftOffset, scale.top);
            context.lineTo(lineLeftOffset, scale.bottom);
            context.stroke();

            // write label
            context.fillStyle = "#ff0000";
            context.textAlign = 'center';
            context.fillText('FIRE DETECTED', lineLeftOffset - .7*scale.left, (scale.bottom - scale.top) / 2 + .25*scale.top);
        },

        afterDatasetsDraw: function (chart, easing) {
            if (chart.config.lineAtIndex) {
                chart.config.lineAtIndex.forEach(pointIndex => this.renderVerticalLine(chart, pointIndex));
            }
        }
    };

Chart.plugins.register(verticalLinePlugin);

var config = {
    type: 'line',
    data: {
        labels: [{% for item in time_pts %}'{{item}}',{% endfor %}],
        datasets: [{
            label: 'Predicted Infared',
            data: [{% for item in pred_pts %}{{item}},{% endfor %}],
            backgroundColor: [
                'rgba(0, 102, 255, 0.2)',
            ],
            borderColor: [
                'rgba(0, 102, 255, 1)',
            ],
            borderWidth: 1
        }, 
        {
            label: 'Actual Infared',
            data: [{% for item in actual_7_pts %}{{item}},{% endfor %}],
            backgroundColor: [
                'rgba(255, 0, 102, 0.2)',
            ],
            borderColor: [
                'rgba(255, 0, 102, 1)',
            ],
            borderWidth: 1
        },
        {
            label: 'Alarm Level',
            data: [{% for item in diff_pts %}{{item}},{% endfor %}],
            borderColor: [
                'rgba(255, 255, 255, 1)',
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        title: {
            display: true,
            text: 'Chart.js Line Chart - Stacked Area'
        },
        tooltips: {
            mode: 'index',
        },
        hover: {
            mode: 'index'
        },
        scales: {
            xAxes: [{
                scaleLabel: {
                    display: true,
                    labelString: 'Month'
                }
            }],
            yAxes: [{
                stacked: true,
                scaleLabel: {
                    display: true,
                    labelString: 'Value'
                }
            }]
        }
    },
    lineAtIndex: [{{ fire_start_idx }}],
}
var myChart = new Chart(ctx, config);
</script>

{% endblock content %}